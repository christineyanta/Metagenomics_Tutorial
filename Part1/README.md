# Obtaining and Filtering Data

## Downloading Raw Sequence Data

For this study, two random samples from each population will be downloaded. Their respective accession numbers are as follows:

* **Urban Italians**
	* Subject 8 - SRR1931178
	* Subject 11 - SRR1930248

* **Hadza Hunter-Gatherers**
	* Subject 19 - SRR1930132
	* Subject 26 - SRR1930143

To download each sample data set, type in the commands:

```bash
$ wget ftp://ftp-trace.ncbi.nih.gov/sra/sra-instant/reads/ByRun/sra/SRR/SRR193/SRR1931178/SRR1931178.sra
$ wget ftp://ftp-trace.ncbi.nih.gov/sra/sra-instant/reads/ByRun/sra/SRR/SRR193/SRR1930248/SRR1930248.sra
$ wget ftp://ftp-trace.ncbi.nih.gov/sra/sra-instant/reads/ByRun/sra/SRR/SRR193/SRR1930132/SRR1930132.sra
$ wget ftp://ftp-trace.ncbi.nih.gov/sra/sra-instant/reads/ByRun/sra/SRR/SRR193/SRR1930143/SRR1930143.sra
```

Each SRA data file downloaded must be coverted into the FASTQ format.  This can be done by typing:

```$ /SRAToolKit/bin/fastq-dump --split-files datafile.sra``` 

Since the data contains paired-end reads, the `--split-files` argument dumps each read into separate files (R1 and R2). 

_Note: If you don't want the reads to be split, but rather all in one file, simply do not include this argument._

Once all of the sequencing reads for each sample are downloaded and converted into FASTQ format, the quality of the reads can be assessed.

## Assessing the Quality of Reads

[FastQC](https://www.bioinformatics.babraham.ac.uk/projects/fastqc/) allows for a quick assessment of quality of the reads obtained. You can obtain an report by typing:

```bash
$ fastqc sample_R1.fq
```

When completed, the program will output a .html report in the same directory you are working in. Open this report and examine the quality of the reads.

## Filtering Reads

Since the sequence data was obtained from another researcher's study (and not original data), it has already undergone demultiplexing.  So the next step would be to filter the reads.

[Fastp](https://github.com/OpenGene/fastp) is a tool that allows for a quick all-in-one preprocessing of FASTQ files. This tool can perform a variety of functions:
* Adapter Trimming
* Filter by Quality and Length
* Base Correction for Paired-End Data
* Overrepresented Sequence Analysis

For our data, we want to perform the following filtering command:

```$ fastp -i Sample_R1.fastq -I Sample_R2.fastq -o Sample.R1.fq.gz -O Sample.R2.fq.gz -c -l 50 -5 -3 -M 15```

Each argument is as follows:
* `-i Sample_R1.fq.gz -I Sample_R2.fq.gz` : paired-end data input
* `-o Sample.R1.fq.gz -O Sample.R2.fq.gz` : paired-end data output
* `-c` : base correction for paired-end data
* `-l 50` : minimum contig length of 50 base pairs
* `-5 -3` : enable per read cutting by quality in 5' and 3' end of sequence
* `-M 15` : mean quality cutoff of 15

When completed, fastp will output a .html file with the summary statistics. This report states how many reads were kept vs. discarded, duplication rate, insert size estimation, and kmer counting. Inspect one of these files to gain further insight on the statistics it reports.

Ensure to unzip the fastq files generated by fastp:
```gunzip Sample.R1.fq.gz```

Once all reads for every sample has been processed, the next step is to assemble the contigs and map.  Please refer to [Read Assembly and Mapping](https://christineyanta.github.io/Metagenomics_Tutorial/Part2) for further instructions.
